<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Constrained optimization · Julia for Machine Learning</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="Julia for Machine Learning logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="Julia for Machine Learning logo"/></a><div class="docs-package-name"><span class="docs-autofit">Julia for Machine Learning</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../why/">Why Julia?</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Installation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../installation/julia/">Julia</a></li><li><a class="tocitem" href="../../installation/vscode/">Visual Studio Code</a></li><li><a class="tocitem" href="../../installation/git/">Git</a></li><li><a class="tocitem" href="../../installation/tutorial/">Quickstart guide</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">1: Variables and basic operators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_01/variables/">Variables</a></li><li><a class="tocitem" href="../../lecture_01/operators/">Elementary functions</a></li><li><a class="tocitem" href="../../lecture_01/strings/">Strings</a></li><li><a class="tocitem" href="../../lecture_01/arrays/">Arrays</a></li><li><a class="tocitem" href="../../lecture_01/data_structures/">Data structures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">2: Control flow</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_02/conditions/">Conditional evaluations</a></li><li><a class="tocitem" href="../../lecture_02/loops/">Loops and iterators</a></li><li><a class="tocitem" href="../../lecture_02/scope/">Soft local scope</a></li><li><a class="tocitem" href="../../lecture_02/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">3: Functions and methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_03/functions/">Functions</a></li><li><a class="tocitem" href="../../lecture_03/methods/">Methods</a></li><li><a class="tocitem" href="../../lecture_03/scope/">Scope of variables</a></li><li><a class="tocitem" href="../../lecture_03/exceptions/">Exception handling</a></li><li><a class="tocitem" href="../../lecture_03/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">4: Packages</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_04/standardlibrary/">Standard library</a></li><li><a class="tocitem" href="../../lecture_04/Plots/">Plots.jl</a></li><li><a class="tocitem" href="../../lecture_04/DataFrames/">DataFrames.jl</a></li><li><a class="tocitem" href="../../lecture_04/otherpackages/">Other useful packages</a></li><li><a class="tocitem" href="../../lecture_04/interaction/">Interaction with other languages</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">5: Type system and generic programming</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_05/compositetypes/">Abstract and composite types</a></li><li><a class="tocitem" href="../../lecture_05/currencies/">Generic programming</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">6: Code organization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_06/modules/">Files and modules</a></li><li><a class="tocitem" href="../../lecture_06/pkg/">Package manager</a></li><li><a class="tocitem" href="../../lecture_06/develop/">Package development</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">Course requirements</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../final_project/homeworks/">Homework</a></li><li><a class="tocitem" href="../../final_project/project/">Final project</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-11" type="checkbox" checked/><label class="tocitem" for="menuitem-11"><span class="docs-label">7: Optimization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../theory/">Introduction to continuous optimization</a></li><li><a class="tocitem" href="../unconstrained/">Unconstrained optimization</a></li><li class="is-active"><a class="tocitem" href>Constrained optimization</a><ul class="internal"><li><a class="tocitem" href="#Numerical-method"><span>Numerical method</span></a></li></ul></li><li><a class="tocitem" href="../exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-12" type="checkbox"/><label class="tocitem" for="menuitem-12"><span class="docs-label">8: Regression and classification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_08/theory/">Theory of regression and classification</a></li><li><a class="tocitem" href="../../lecture_08/linear/">Linear regression</a></li><li><a class="tocitem" href="../../lecture_08/logistic/">Logistic regression</a></li><li><a class="tocitem" href="../../lecture_08/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-13" type="checkbox"/><label class="tocitem" for="menuitem-13"><span class="docs-label">9: Neural networks I.</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_09/theory/">Theory of neural networks</a></li><li><a class="tocitem" href="../../lecture_09/nn/">Neural networks</a></li><li><a class="tocitem" href="../../lecture_09/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14" type="checkbox"/><label class="tocitem" for="menuitem-14"><span class="docs-label">10: Neural networks II.</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_10/theory/">Theory of neural networks</a></li><li><a class="tocitem" href="../../lecture_10/nn/">More complex networks</a></li><li><a class="tocitem" href="../../lecture_10/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-15" type="checkbox"/><label class="tocitem" for="menuitem-15"><span class="docs-label">11: Statistics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_11/theory/">Statistics</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-16" type="checkbox"/><label class="tocitem" for="menuitem-16"><span class="docs-label">12: Ordinary differential equations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_12/theory/">Differential equations</a></li><li><a class="tocitem" href="../../lecture_12/ode/">Wave equation</a></li><li><a class="tocitem" href="../../lecture_12/diff_eq/">Julia package</a></li><li><a class="tocitem" href="../../lecture_12/optimal_control/">Optimal control</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">7: Optimization</a></li><li class="is-active"><a href>Constrained optimization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Constrained optimization</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/VaclavMacha/JuliaCourse/blob/master/docs/src/lecture_07/constrained.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="lagrangian"><a class="docs-heading-anchor" href="#lagrangian">Constrained optimization</a><a id="lagrangian-1"></a><a class="docs-heading-anchor-permalink" href="#lagrangian" title="Permalink"></a></h1><p>The usual formulation of constrained optimization is</p><p class="math-container">\[\tag{P}
\begin{aligned}
\text{minimize}\qquad &amp;f(x) \\
\text{subject to}\qquad &amp;g_i(x) \le 0,\ i=1,\dots,I, \\
&amp;h_j(x) = 0,\ j=1,\dots,J.
\end{aligned}\]</p><p>This optimization problem is also called the primal formulation. It is closely connected with the Lagrangian</p><p class="math-container">\[L(x;\lambda,\mu) = f(x)  + \sum_{i=1}^I \lambda_i g_i(x) + \sum_{j=1}^J \mu_j h_j(x).\]</p><p>Namely, it is simple to show that the primal formulation (P) is equivalent to</p><p class="math-container">\[\operatorname*{minimize}_x\quad \operatorname*{maximize}_{\lambda\ge 0,\mu}\quad L(x;\lambda,\mu).\]</p><p>The dual problem then switches the minimization and maximization to arrive at</p><p class="math-container">\[\tag{D} \operatorname*{maximize}_{\lambda\ge 0,\mu} \quad\operatorname*{minimize}_x\quad L(x;\lambda,\mu).\]</p><div class = "info-body">
<header class = "info-header">Linear programming</header><p><p>The linear program</p><p class="math-container">\[\begin{aligned}
\text{minimize}\qquad &amp;c^\top x \\
\text{subject to}\qquad &amp;Ax=b, \\
&amp;x\ge 0
\end{aligned}\]</p><p>is equivalent to</p><p class="math-container">\[\begin{aligned}
\text{maximize}\qquad &amp;b^\top \mu \\
\text{subject to}\qquad &amp;A^\top \mu\le c.
\end{aligned}\]</p><p>We can observe several things:</p><ol><li>Primal and dual problems switch minimization and maximization.</li><li>Primal and dual problems switch variables and constraints.</li></ol></p></div><p>The optimality conditions for constrained optimization take a more complex form.</p><div class = "theorem-body">
<header class = "theorem-header">Theorem: Karush-Kuhn-Tucker conditions</header><p><p>Let <span>$f$</span>, <span>$g_i$</span> and <span>$h_j$</span> be differentiable function and let a constraint qualification hold. If <span>$x$</span> is a local minimum of the primal problem (P), then there are <span>$\lambda\ge 0$</span> and <span>$\mu$</span> such that</p><p class="math-container">\[    \begin{aligned}
    &amp;\text{Optimality:} &amp;&amp; \nabla_x L(x;\lambda,\mu) = 0, \\
    &amp;\text{Feasibility:} &amp;&amp; \nabla_\lambda L(x;\lambda,\mu)\le 0,\ \nabla_\mu L(x;\lambda,\mu) = 0, \\
    &amp;\text{Complementarity:} &amp;&amp; \lambda^\top g(x) = 0.
    \end{aligned}\]</p><p>If <span>$f$</span> and <span>$g$</span> are convex and <span>$h$</span> is linear, then every stationary point is a global minimum of (P).</p></p></div><h2 id="Numerical-method"><a class="docs-heading-anchor" href="#Numerical-method">Numerical method</a><a id="Numerical-method-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-method" title="Permalink"></a></h2><p>We present only the simplest method for constraint optimization. Projected gradients </p><p class="math-container">\[\begin{aligned}
y^{k+1} &amp;= x^k - \alpha^k\nabla f(x^k), \\
x^{k+1} &amp;= P_X(y^{k+1})
\end{aligned}\]</p><p>compute the gradient as for standard gradient descent, and then project the point onto the feasible set. Since the projection needs to be simple to compute, projected gradients are used for simple sets <span>$X$</span> such as boxes or balls. </p><p>We will use projected gradients to solve</p><p class="math-container">\[\begin{aligned}
\text{minimize}\qquad &amp;\sin(x_1 + x_2) + \cos(x_1)^2 \\
\text{subject to}\qquad &amp;x_1, x_2\in [-1,1].
\end{aligned}\]</p><p>The implementation of projected gradients is the same as gradient descent but it needs projection function <code>P</code> as input. For reasons of plotting, it returns both <span>$x$</span> and <span>$y$</span>.</p><pre><code class="language-julia">function optim(f, g, P, x, α; max_iter=100)
    xs = zeros(length(x), max_iter+1)
    ys = zeros(length(x), max_iter)
    xs[:,1] = x
    for i in 1:max_iter
        ys[:,i] = xs[:,i] - α*g(xs[:,i])
        xs[:,i+1] = P(ys[:,i])
    end
    return xs, ys
end</code></pre><p>The projection function <code>P</code> computes the projection on <code>[x_min, x_max]</code>. Since it is a box, the projection is computed componentwise:</p><pre><code class="language-julia">P(x, x_min, x_max) = min.(max.(x, x_min), x_max)</code></pre><p>Now we can call projected gradients from the same starting point as before</p><pre><code class="language-julia">x_min = [-1; -1]
x_max = [0; 0]

xs, ys = optim(f, g, x -&gt; P(x,x_min,x_max), [0;-1], 0.1)</code></pre><p>To plot the path, we need to merge them together when one point from <code>xs</code> is followed by a point from <code>ys</code> and so on. Since <code>xs</code> and <code>ys</code> have different number of entries, we can do it via</p><pre><code class="language-julia">xys = hcat(reshape([xs[:,1:end-1]; ys][:], 2, :), xs[:,end])</code></pre><p>It is probably not the nicest thing to do, but it is Saturday evening, I am tired and it works. Sorry :) The animation can be created in the same way aa before. </p><pre><code class="language-julia">xlims = (-3, 1)
ylims = (-2, 1)

create_anim(f, xys, xlims, ylims; file_name = &quot;anim6.gif&quot;)</code></pre><pre class="documenter-example-output">┌ Info: Saved animation to
└   fn = &quot;/home/runner/work/JuliaCourse/JuliaCourse/docs/build/lecture_07/anim6.gif&quot;</pre><p><img src="../anim6.gif" alt/></p><p>There is one significant drawback to this animation: One cannot see the boundary. One possibility would be to reduce the plotting ranges <code>xlims</code> and <code>ylims</code>. However, then one would not see the iterations outside of the box. Another possibility is to modify <code>f</code> into <code>f_mod</code> which has the same values inside the box and is constant outside of it. Because <code>f</code> is bounded below by <span>$-1$</span>, we define <code>f_mod</code> by <span>$-2$</span> outside of the box. </p><pre><code class="language-julia">f_mod(x) = all(x .&gt;= x_min) &amp;&amp; all(x .&lt;= x_max) ? f(x) : -2
f_mod(x1,x2) = f_mod([x1; x2])

create_anim(f_mod, xys, xlims, ylims; file_name = &quot;anim7.gif&quot;)</code></pre><pre class="documenter-example-output">┌ Info: Saved animation to
└   fn = &quot;/home/runner/work/JuliaCourse/JuliaCourse/docs/build/lecture_07/anim7.gif&quot;</pre><p><img src="../anim7.gif" alt/></p><p>The animation shows that projected gradients converge to the global minimum. Most of the iterations are outside of the feasible region but they are projected back to boundary. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../unconstrained/">« Unconstrained optimization</a><a class="docs-footer-nextpage" href="../exercises/">Exercises »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 27 March 2021 13:41">Saturday 27 March 2021</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
