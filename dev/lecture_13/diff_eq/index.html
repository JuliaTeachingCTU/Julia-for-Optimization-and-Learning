<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Julia package · Julia for Optimization and Learning</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="Julia for Optimization and Learning logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="Julia for Optimization and Learning logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Julia for Optimization and Learning</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../why/">Why Julia?</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Installation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../installation/julia/">Julia</a></li><li><a class="tocitem" href="../../installation/vscode/">Visual Studio Code</a></li><li><a class="tocitem" href="../../installation/git/">Git</a></li><li><a class="tocitem" href="../../installation/tutorial/">Quickstart guide</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">1: Variables and basic operators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_01/variables/">Variables</a></li><li><a class="tocitem" href="../../lecture_01/operators/">Elementary functions</a></li><li><a class="tocitem" href="../../lecture_01/strings/">Strings</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">2: Data structures</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_02/arrays/">Arrays</a></li><li><a class="tocitem" href="../../lecture_02/tuples/">Tuples and named tuples</a></li><li><a class="tocitem" href="../../lecture_02/dictionaries/">Dictionaries</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">3: Control flow</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_03/conditions/">Conditional evaluations</a></li><li><a class="tocitem" href="../../lecture_03/loops/">Loops and iterators</a></li><li><a class="tocitem" href="../../lecture_03/scope/">Soft local scope</a></li><li><a class="tocitem" href="../../lecture_03/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">4: Functions and methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_04/functions/">Functions</a></li><li><a class="tocitem" href="../../lecture_04/methods/">Methods</a></li><li><a class="tocitem" href="../../lecture_04/scope/">Scope of variables</a></li><li><a class="tocitem" href="../../lecture_04/exceptions/">Exception handling</a></li><li><a class="tocitem" href="../../lecture_04/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">5: Packages</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_05/standardlibrary/">Standard library</a></li><li><a class="tocitem" href="../../lecture_05/Plots/">Plots.jl</a></li><li><a class="tocitem" href="../../lecture_05/DataFrames/">DataFrames.jl</a></li><li><a class="tocitem" href="../../lecture_05/otherpackages/">Other useful packages</a></li><li><a class="tocitem" href="../../lecture_05/interaction/">Interaction with other languages</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">6: Type system and generic programming</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_06/compositetypes/">Abstract and composite types</a></li><li><a class="tocitem" href="../../lecture_06/currencies/">Generic programming</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">7: Code organization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_07/modules/">Files and modules</a></li><li><a class="tocitem" href="../../lecture_07/pkg/">Package manager</a></li><li><a class="tocitem" href="../../lecture_07/develop/">Package development</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-11" type="checkbox"/><label class="tocitem" for="menuitem-11"><span class="docs-label">8: Optimization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_08/theory/">Introduction to continuous optimization</a></li><li><a class="tocitem" href="../../lecture_08/unconstrained/">Unconstrained optimization</a></li><li><a class="tocitem" href="../../lecture_08/constrained/">Constrained optimization</a></li><li><a class="tocitem" href="../../lecture_08/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-12" type="checkbox"/><label class="tocitem" for="menuitem-12"><span class="docs-label">9: Regression and classification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_09/theory/">Introduction to regression and classification</a></li><li><a class="tocitem" href="../../lecture_09/linear/">Linear regression</a></li><li><a class="tocitem" href="../../lecture_09/logistic/">Logistic regression</a></li><li><a class="tocitem" href="../../lecture_09/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-13" type="checkbox"/><label class="tocitem" for="menuitem-13"><span class="docs-label">10: Neural networks I.</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_10/theory/">Theory of neural networks</a></li><li><a class="tocitem" href="../../lecture_10/nn/">Neural networks</a></li><li><a class="tocitem" href="../../lecture_10/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-14" type="checkbox"/><label class="tocitem" for="menuitem-14"><span class="docs-label">11: Neural networks II.</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_11/theory/">Theory of neural networks</a></li><li><a class="tocitem" href="../../lecture_11/iris/">Introduction to Flux</a></li><li><a class="tocitem" href="../../lecture_11/nn/">More complex networks</a></li><li><a class="tocitem" href="../../lecture_11/exercises/">Exercises</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-15" type="checkbox"/><label class="tocitem" for="menuitem-15"><span class="docs-label">12: Statistics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../lecture_12/sparse/">Linear regression with sparse constraints</a></li><li><a class="tocitem" href="../../lecture_12/monte/">Monte Carlo sampling</a></li><li><a class="tocitem" href="../../lecture_12/glm/">Linear regression revisited</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-16" type="checkbox" checked/><label class="tocitem" for="menuitem-16"><span class="docs-label">13: Ordinary differential equations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../theory/">Differential equations</a></li><li><a class="tocitem" href="../ode/">Wave equation</a></li><li class="is-active"><a class="tocitem" href>Julia package</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Lorenz-system"><span>Lorenz system</span></a></li></ul></li><li><a class="tocitem" href="../optimal_control/">Optimal control</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">13: Ordinary differential equations</a></li><li class="is-active"><a href>Julia package</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Julia package</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaTeachingCTU/Julia-for-Optimization-and-Learning/blob/master/docs/src/lecture_13/diff_eq.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Julia-package"><a class="docs-heading-anchor" href="#Julia-package">Julia package</a><a id="Julia-package-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-package" title="Permalink"></a></h1><p>To solve differential equations, we use the package <a href="https://diffeq.sciml.ai/stable/">DifferentialEquations</a>, which consider ODEs in the form</p><p class="math-container">\[\dot u(t) = f(t, u(t), p(t))\]</p><p>with the initial condition <span>$u(t_0)= u_0$</span>. While <span>$u$</span> is the solution, <span>$p$</span> describes external parameters.</p><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>We start with the following simple problem:</p><p class="math-container">\[\begin{aligned}
\dot u(t) &amp;= 0.98u, \\
u(0) &amp;= 1.
\end{aligned}\]</p><p>This equation has the closed-form solution <span>$u(t) = e^{0.98t}$</span>. To solve it by <code>DifferentialEquations</code>, we first need to create the problem <code>prob</code> by supplying the function <span>$f$</span>, the initial point <span>$u_0$</span> and the time interval <span>$[t_0,t_1]$</span> to the constructor <code>ODEProblem</code>.</p><pre><code class="language-julia hljs">using DifferentialEquations

f(u,p,t) = 0.98*u

u0 = 1.0
tspan = (0.0, 1.0)

prob = ODEProblem(f, u0, tspan)</code></pre><p>Then we use the <code>solve</code> function to solve the equation.</p><pre><code class="language-julia hljs">sol = solve(prob)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: specialized 4th order &quot;free&quot; interpolation, specialized 2nd order &quot;free&quot; stiffness-aware interpolation
t: 5-element Vector{Float64}:
 0.0
 0.10042494449239292
 0.35218603951893646
 0.6934436028208104
 1.0
u: 5-element Vector{Float64}:
 1.0
 1.1034222047865465
 1.4121908848175448
 1.9730384275622996
 2.664456142481451</code></pre><p>The first line says that the solution was successful, which can be automatically checked by accessing the field <code>sol.retcode</code>. The second line specifies the interpolation method, and the following lines the solution. Even though the solution was evaluated at only five points, the interpolation allows plotting a smooth function.</p><pre><code class="language-julia hljs">using Plots

plot(sol; label=&quot;&quot;)</code></pre><p><img src="../intro.svg" alt/></p><p>The <code>sol</code> structure can be used to evaluate the solution <span>$u$</span>.</p><pre><code class="language-julia hljs">sol(0.8)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2.1902158127997695</code></pre><p>The following exercise shows how to specify the interpolation technique and compares the results.</p><div class="admonition is-category-exercise">
<header class="admonition-header">Exercise:</header>
<div class="admonition-body"><p>When calling the <code>solve</code> function, we can specify the interpolation way. Solve the ODE with linear interpolation (<code>dense=false</code>) and the Runge-Kutta method of the fourth order (<code>RK4()</code>). Plot the results and compare them with the default and original solutions.</p></div></div>
<details class = "solution-body">
<summary class = "solution-header">Solution:</summary><p><p>To compute the additional solutions, we add the arguments as specified above.</p><pre><code class="language-julia hljs">sol2 = solve(prob, dense=false)
sol3 = solve(prob, RK4())</code></pre><p>We create a discretization <code>ts</code> of the time interval and then plot the four functions.</p><pre><code class="language-julia hljs">ts = range(tspan...; length = 100)

plot(ts, t-&gt;exp(0.98*t), label=&quot;True solution&quot;, legend=:topleft)
plot!(ts, t-&gt;sol(t), label=&quot;Default&quot;)
plot!(ts, t-&gt;sol2(t), label=&quot;Linear&quot;)
plot!(ts, t-&gt;sol3(t), label=&quot;Runge-Kutta&quot;)</code></pre></p></details><p><img src="../Comparison.svg" alt/></p><p>We see that all solutions are the same except for the linear approximation.</p><h2 id="Lorenz-system"><a class="docs-heading-anchor" href="#Lorenz-system">Lorenz system</a><a id="Lorenz-system-1"></a><a class="docs-heading-anchor-permalink" href="#Lorenz-system" title="Permalink"></a></h2><p>The <a href="https://en.wikipedia.org/wiki/Lorenz_system">Lorenz system</a> is a prime example of the <a href="https://en.wikipedia.org/wiki/Butterfly_effect">butterfly effect</a> in the chaos theory. There, small changes in the initial conditions result in large changes in the solution. This effect was first described in 1961 during work on weather modelling.</p><p>The following equations describe the three-dimensional Lorenz system:</p><p class="math-container">\[\begin{aligned}
\frac{\partial x}{\partial t} &amp;= \sigma (y - x), \\
\frac{\partial y}{\partial t} &amp;= x (\rho - z) - y, \\
\frac{\partial z}{\partial t} &amp;= x y - \beta z.
\end{aligned}\]</p><p>We first define the right-hand side of the system.</p><pre><code class="language-julia hljs">function lorenz(u, p, t)
    σ, ρ, β = p
    x_t = σ*(u[2]-u[1])
    y_t = u[1]*(ρ-u[3]) - u[2]
    z_t = u[1]*u[2] - β*u[3]
    return [x_t; y_t; z_t]
end</code></pre><p>The parameters are saved in a tuple or array <code>p</code>. Since the right-hand side of the Lorenz system is a vector, we need to return a vector as well. Now, we compute the solution in the same way as before.</p><pre><code class="language-julia hljs">u0 = [1.0; 0.0; 0.0]
p = [10; 28; 8/3]

tspan = (0.0, 100.0)
prob = ODEProblem(lorenz, u0, tspan, p)

sol = solve(prob)</code></pre><p>We plot the solution:</p><pre><code class="language-julia hljs">plot(sol)</code></pre><p><img src="../lorenz0.svg" alt/></p><p>Since this is a two-dimensional graph of all coordinates, we need to specify that we want to plot a 3D graph.</p><pre><code class="language-julia hljs">plt1 = plot(sol, vars=(1,2,3), label=&quot;&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: To maintain consistency with solution indexing, keyword argument vars will be removed in a future version. Please use keyword argument idxs instead.
│   caller = ip:0x0
└ @ Core :-1</code></pre><p><img src="../lorenz1.svg" alt/></p><p>We see the power of interpolation again. If we used linear interpolation, which amounts to connecting the points, we would obtain a much coarse graph.</p><pre><code class="language-julia hljs">plot(sol, vars=(1,2,3), denseplot=false; label=&quot;&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: To maintain consistency with solution indexing, keyword argument vars will be removed in a future version. Please use keyword argument idxs instead.
│   caller = ip:0x0
└ @ Core :-1</code></pre><p><img src="../lorenz2.svg" alt/></p><p>This graph shows the strength of the <code>DifferentialEquations</code> package. With a small computational effort, it can compute a good solution. Note that the last plotting call is equivalent to:</p><pre><code class="language-julia hljs">traj = hcat(sol.u...)
plot(traj[1,:], traj[2,:], traj[3,:]; label=&quot;&quot;)</code></pre><p>In the introduction, we mentioned chaos theory. We will elaborate on this in the following exercise.</p><div class="admonition is-category-exercise">
<header class="admonition-header">Exercise:</header>
<div class="admonition-body"><p>Use the <code>nextfloat</code> function to perturb the first parameter of <code>p</code> by the smallest possible value. Then solve the Lorenz system again and compare the results by plotting the two trajectories next to each other.</p></div></div>
<details class = "solution-body">
<summary class = "solution-header">Solution:</summary><p><p>We start with the smallest possible perturbation of the initial value.</p><pre><code class="language-julia hljs">p0 = (nextfloat(p[1]), p[2:end]...)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(10.000000000000002, 28.0, 2.6666666666666665)</code></pre><p>Then we plot the graphs as before</p><pre><code class="language-julia hljs">prob0 = ODEProblem(lorenz, u0, tspan, p0)
sol0 = solve(prob0)

plt0 = plot(sol0, vars=(1,2,3), label=&quot;&quot;)

plot(plt1, plt0; layout=(1,2))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: To maintain consistency with solution indexing, keyword argument vars will be removed in a future version. Please use keyword argument idxs instead.
│   caller = ip:0x0
└ @ Core :-1</code></pre></p></details><p><img src="../lorenz4.svg" alt/></p><p>The solutions look different. Comparing the terminal states of both solutions</p><pre><code class="language-julia hljs">hcat(sol(tspan[2]), sol0(tspan[2]))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3×2 Matrix{Float64}:
 -2.94542  -0.628467
 -1.84189  -3.10333
 22.7963   23.3035</code></pre><p>shows that they are different by a large margin. This raises a natural question.</p><div class="admonition is-category-exercise">
<header class="admonition-header">Exercise:</header>
<div class="admonition-body"><p>Can we trust the solutions? Why?</p></div></div>
<details class = "solution-body">
<summary class = "solution-header">Solution:</summary><p><p>Unfortunately, we cannot. Numerical methods always introduce some errors by</p><ul><li><em>Rounding errors</em> due to representing real numbers in machine precision.</li><li><em>Discretization errors</em> for continuous systems when the finite difference method approximates the derivative.</li></ul><p>However, if the system itself is unstable and an extremely small perturbation results in big differences in solutions, the numerical method even enhances these errors. The solution could be trusted on some small interval but not after it.</p></p></details><p>The following section shows a situation where we try to mitigate this possible effect by using mathematical formulas to compute the exact solution as long as possible. This aproach delays the necessary discretization and may bring better stability.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ode/">« Wave equation</a><a class="docs-footer-nextpage" href="../optimal_control/">Optimal control »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Tuesday 9 August 2022 09:19">Tuesday 9 August 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
